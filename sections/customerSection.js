import { useEffect, useState } from "react";
import { Customers as customers } from "../data/customers.data";
import { motion, AnimatePresence } from "framer-motion";

// COMPONENTS

import FilterToggle from "../components/filterToggle";
import FilterTypes from "../components/filterTypes";
import SortButtons from "../components/sortButtons";

// FUNCTIONS

import {
  filterByIndustry,
  filterByCountry,
  sortCustomers,
} from "../functions/utils";

export default function CustomerSection() {
  const [filteredList, setFilteredList] = useState(customers);
  const [activeIndustry, setActiveIndustry] = useState("All Industries");
  const [activeCountry, setActiveCountry] = useState("All Countries");
  const [sortType, setSortType] = useState("Default");
  const [sortDirection, setSortDirection] = useState("Descending");

  const [toggled, setIsToggled] = useState(false);

  useEffect(() => {
    setFilteredList(
      sortCustomers(
        filterByCountry(
          filterByIndustry(customers, activeIndustry),
          activeCountry
        ),
        sortType,
        sortDirection
      )
    );
  }, [activeIndustry, activeCountry, sortType, sortDirection]);

  return (
    <section id="customers" className="bg-light-blue-50">
      <div className="mt-8 mx-auto max-w-7xl px-4 sm:mt-12 lg:mt-4 xl:-mt-10 xl:pt-10">
        <div className="text-center">
          <h2 className="text-3xl tracking-tight font-semibold  text-gray-600 sm:text-4xl md:text-4xl">
            Browse through all our customers
          </h2>
        </div>
      </div>

      {/* BUTTONS/DROPDOWNS */}
      <div className="mx-auto max-w-7xl px-5 pt-4 lg:px-20 lg:pt-10">
        <div className="mt-10 flex items-end sm:justify-between lg:space-x-8">
          <FilterToggle toggled={toggled} setIsToggled={setIsToggled} />
          <SortButtons
            sortType={sortType}
            setSortType={setSortType}
            sortDirection={sortDirection}
            setSortDirection={setSortDirection}
          />
        </div>

        {/* Filter SUBSECTION */}

        {toggled && (
          <div
            id="toggled-filters"
            className="mt-5 w-full space-y-3 border-t border-light-blue-200 pt-4 sm:items-center sm:space-y-0 sm:grid sm:grid-cols-3 sm:gap-4 xl:flex xl:gap-0 xl:space-x-4"
          >
            <FilterTypes
              customers={customers}
              activeIndustry={activeIndustry}
              activeCountry={activeCountry}
              setActiveIndustry={setActiveIndustry}
              setActiveCountry={setActiveCountry}
            />
          </div>
        )}

        {/* END OF BUTTONS / DROPDOWNS */}
      </div>

      {/* DISPLAYED COMPANIES */}

      <motion.ol
        className="mx-auto grid max-w-7xl grid-cols-2 gap-5 px-5 py-10 sm:px-6 md:grid-cols-3 lg:grid-cols-4 lg:p-20"
        layout
      >
        {filteredList.map((customer, i) => (
          <AnimatePresence key={customer.id}>
            <motion.li
              layout
              initial={{ opacity: 0, translateX: -50 }}
              animate={{ opacity: 1, translateX: 0 }}
              transition={{ duration: 0.65, delay: i * 0.05 }}
              className="flex items-center justify-center rounded-lg bg-white shadow-md  "
              key={customer.id}
            >
              <img
                src={customer.imgSrc}
                width={215}
                height={60}
                className="h-auto max-h-36 w-full object-scale-down p-8 "
                alt={`Logo of ${customer.name}, a Pentest-Tools.com customer`}
                title={`${customer.name} is a Pentest-Tools.com customer `}
              />
            </motion.li>
          </AnimatePresence>
        ))}
      </motion.ol>
    </section>
  );
}
